---
/**
 * ProjectsSection Component
 * Featured projects section for homepage
 * Fetches and displays top repositories from GitHub API
 */
import { user } from '../../data/user.config';
import { getUserRepos, formatNumber, getLanguageColor } from '../../utils/github';

let featuredProjects = [];

try {
  console.log(`üîç Fetching repositories for user: ${user.github.username}`);
  const allRepos = await getUserRepos(user.github.username);
  
  if (allRepos && allRepos.length > 0) {
    featuredProjects = allRepos
      .filter(repo => !repo.isFork)
      .sort((a, b) => b.stars - a.stars)
      .slice(0, 6)
      .map(repo => ({
        ...repo,
        featured: repo.stars > 0,
        customTags: [],
      }));
    
    console.log(`‚úÖ Loaded ${featuredProjects.length} repositories for homepage`);
  } else {
    console.warn(`‚ö†Ô∏è No repositories found for user: ${user.github.username}`);
  }
} catch (error) {
  console.error(`‚ùå Error fetching repositories:`, error);
  featuredProjects = [];
}
---

<div class="projects-section h-full box-border flex flex-col px-4 py-6 overflow-y-auto">
  <div class="max-w-6xl mx-auto w-full flex-shrink-0">
    <!-- Section Header -->
    <div class="section-header text-center mb-6 relative">
      <div class="absolute inset-0 -z-10 opacity-30">
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-[var(--md-sys-color-tertiary)]/10 to-[var(--md-sys-color-primary)]/10 rounded-full blur-3xl"></div>
      </div>
      
      <h2 class="section-title inline-flex items-center justify-center gap-2 text-2xl md:text-3xl font-700 text-[var(--md-sys-color-on-surface)] mb-2">
        <span class="icon-wrapper inline-flex items-center justify-center w-10 h-10 bg-gradient-to-br from-[var(--md-sys-color-tertiary-container)] to-[var(--md-sys-color-primary-container)] rounded-xl">
          <i class="i-carbon:cube text-xl text-[var(--md-sys-color-tertiary)]"></i>
        </span>
        <span class="bg-gradient-to-r from-[var(--md-sys-color-tertiary)] to-[var(--md-sys-color-primary)] bg-clip-text text-transparent" data-i18n="projects.title">
          Featured Projects
        </span>
      </h2>
      <p class="section-subtitle text-xs md:text-sm text-[var(--md-sys-color-on-surface-variant)] font-500" data-i18n="projects.subtitle">
        Open source ¬∑ technical practice ¬∑ continuous creation
      </p>
      
      <div class="flex items-center justify-center gap-2 mt-3">
        <div class="w-12 h-0.5 bg-gradient-to-r from-transparent to-[var(--md-sys-color-tertiary)]/50"></div>
        <div class="w-2 h-2 rounded-full bg-[var(--md-sys-color-tertiary)]"></div>
        <div class="w-12 h-0.5 bg-gradient-to-l from-transparent to-[var(--md-sys-color-tertiary)]/50"></div>
      </div>
    </div>

    <!-- Project grid -->
    {featuredProjects.length > 0 ? (
      <div class="projects-grid grid gap-3 md:gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
        {featuredProjects.map((project, index) => (
          <a
            href={`/projects/${project.owner}/${project.name}`}
            class="card-interactive project-card group animate-fade-in relative p-4 flex flex-col gap-3 overflow-hidden"
            style={`animation-delay: ${index * 100}ms;`}
          >
              <!-- Decorative gradient background -->
              <div class="absolute inset-0 bg-gradient-to-br from-[var(--md-sys-color-tertiary)]/8 to-[var(--md-sys-color-primary)]/8 opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl pointer-events-none"></div>
              
              <!-- Accent glow -->
              <div class="absolute -top-8 -right-8 w-28 h-28 bg-gradient-to-br from-[var(--md-sys-color-tertiary)]/15 to-[var(--md-sys-color-primary)]/15 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700 pointer-events-none"></div>
              
              <!-- Project header -->
              <div class="project-header relative z-10 flex items-start justify-between mb-3">
                <div class="flex items-center gap-2">
                    
                    <!-- Featured indicator -->
                    {project.featured && (
                      <span class="featured-badge inline-flex items-center gap-1 px-2.5 py-1 text-xs font-600 bg-gradient-to-r from-[var(--md-sys-color-tertiary-container)] to-[var(--md-sys-color-primary-container)] text-[var(--md-sys-color-on-tertiary-container)] rounded-full backdrop-blur-sm shadow-sm">
                        <i class="i-carbon:star-filled text-xs"></i>
                        <span data-i18n="projects.featured">Featured</span>
                      </span>
                    )}
                  </div>
                </div>

              <!-- Project title -->
              <h3 class="project-title relative z-10 text-base md:text-lg font-700 text-[var(--md-sys-color-on-surface)] mb-2 line-clamp-1 group-hover:text-[var(--md-sys-color-tertiary)] transition-colors leading-snug">
                {project.name}
              </h3>

              <!-- Project description -->
              <p class="project-description relative z-10 text-sm text-[var(--md-sys-color-on-surface-variant)]/90 mb-3 line-clamp-2 flex-1 leading-relaxed min-h-[2.5rem]">
                {project.description || <span data-i18n="projects.noDescription">No description provided</span>}
              </p>

              <!-- Metrics and language -->
              <div class="project-stats relative z-10 flex items-center gap-3 mb-3 text-xs text-[var(--md-sys-color-on-surface-variant)]">
                {project.language && (
                  <span class="flex items-center gap-1.5">
                    <span class="w-2.5 h-2.5 rounded-full shadow-sm" style={`background-color: ${getLanguageColor(project.language)}`}></span>
                    <span class="font-500">{project.language}</span>
                  </span>
                )}
                <span class="flex items-center gap-1 group-hover:text-[var(--md-sys-color-tertiary)] transition-colors">
                  <i class="i-carbon:star text-sm"></i>
                  {formatNumber(project.stars)}
                </span>
                <span class="flex items-center gap-1 group-hover:text-[var(--md-sys-color-primary)] transition-colors">
                  <i class="i-carbon:branch text-sm"></i>
                  {formatNumber(project.forks)}
                </span>
              </div>

              <!-- Tags -->
              {(project.topics && project.topics.length > 0) && (
                <div class="project-tags relative z-10 flex flex-wrap gap-1.5 mt-auto pt-3 border-t border-[var(--md-sys-color-outline-variant)]/30">
                  {project.topics.slice(0, 3).map((tag) => (
                    <span class="tag inline-flex items-center px-2.5 py-1 text-xs font-500 bg-gradient-to-r from-[var(--md-sys-color-tertiary-container)]/70 to-[var(--md-sys-color-primary-container)]/70 text-[var(--md-sys-color-on-tertiary-container)] rounded-full backdrop-blur-sm shadow-sm">
                      {tag}
                    </span>
                  ))}
                  {project.topics.length > 3 && (
                    <span class="text-xs text-[var(--md-sys-color-on-surface-variant)] font-500">
                      +{project.topics.length - 3}
                    </span>
                  )}
                </div>
              )}
              
              <!-- View project indicator -->
              <div class="view-indicator relative z-10 flex items-center gap-1 mt-3 text-sm font-600 text-[var(--md-sys-color-tertiary)] opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <span data-i18n="projects.viewProject">View project</span>
                <i class="i-carbon:arrow-right text-sm group-hover:translate-x-1 transition-transform"></i>
              </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="empty-state text-center py-12">
        <i class="i-carbon:cube text-5xl text-[var(--md-sys-color-outline)] mb-3"></i>
        <p class="text-sm text-[var(--md-sys-color-on-surface-variant)]" data-i18n="projects.empty">No projects available</p>
      </div>
    )}

    <!-- View-more button -->
    {featuredProjects.length > 0 && (
      <div class="view-more text-center mt-6">
        <a 
          href="/projects" 
          class="inline-flex items-center gap-2 px-6 py-2 text-sm font-700 bg-gradient-to-r from-[var(--md-sys-color-tertiary)] to-[var(--md-sys-color-primary)] text-white rounded-full shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105 hover:gap-3 group relative overflow-hidden"
        >
          <!-- Sweeping highlight -->
          <span class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></span>
          
          <span class="relative z-10" data-i18n="projects.viewAll">View all projects</span>
          <i class="i-carbon:arrow-right text-lg relative z-10 group-hover:translate-x-1 transition-transform"></i>
        </a>
        
        <!-- Aggregated statistics -->
        <div class="flex items-center justify-center gap-4 mt-4 text-xs text-[var(--md-sys-color-on-surface-variant)]">
          <span class="flex items-center gap-1.5">
            <i class="i-carbon:cube text-sm text-[var(--md-sys-color-tertiary)]"></i>
            {featuredProjects.length} <span data-i18n="projects.stats.featured">featured projects</span>
          </span>
          <span class="w-1 h-1 rounded-full bg-[var(--md-sys-color-outline)]"></span>
          <span class="flex items-center gap-1.5">
            <i class="i-carbon:star text-sm text-[var(--md-sys-color-tertiary)]"></i>
            {featuredProjects.reduce((sum, p) => sum + p.stars, 0)} <span data-i18n="projects.stats.stars">Stars</span>
          </span>
        </div>
      </div>
    )}
  </div>
</div>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* Fade-in animation */
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fade-in {
    opacity: 0;
    animation: fade-in 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  /* Icon pulse animation */
  .icon-wrapper {
    animation: pulse-glow 2s ease-in-out infinite;
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 var(--md-sys-color-tertiary);
      opacity: 1;
    }
    50% {
      box-shadow: 0 0 20px 5px var(--md-sys-color-tertiary);
      opacity: 0.8;
    }
  }
  
  /* Project card */
  .project-card {
    display: block;
    text-decoration: none;
    color: inherit;
  }
  
  .card-inner {
    will-change: transform;
  }
  
  /* Tag hover effect */
  .tag {
    cursor: default;
    position: relative;
    transition: all 0.3s;
  }
  
  .tag:hover {
    transform: scale(1.05);
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .projects-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
