# Internationalization (i18n)

Add multi-language support to your site.

## Overview

This theme supports internationalization, allowing you to create content in multiple languages and provide language-specific UI translations.

**Current Status:** Basic i18n structure is in place. Full implementation requires additional configuration.

## Features

- Multiple language support
- Language-specific routes
- UI translation system
- Date and number localization
- Language switcher component

## Quick Start

### 1. Enable i18n in Astro Config

Edit `astro.config.mjs`:

```javascript
export default defineConfig({
  i18n: {
    defaultLocale: 'en',
    locales: ['en', 'zh-cn', 'ja'],
    routing: {
      prefixDefaultLocale: false
    }
  }
})
```

### 2. Create Language Files

Create translation files in `src/i18n/`:

```
src/i18n/
├── en.json       # English
├── zh-cn.json    # Simplified Chinese
└── ja.json       # Japanese
```

### 3. Add Translations

**src/i18n/en.json:**
```json
{
  "nav": {
    "home": "Home",
    "blog": "Blog",
    "projects": "Projects",
    "about": "About"
  },
  "blog": {
    "readMore": "Read More",
    "published": "Published on",
    "updated": "Updated on",
    "readingTime": "min read"
  },
  "common": {
    "backToTop": "Back to Top",
    "loading": "Loading...",
    "notFound": "Page Not Found"
  }
}
```

**src/i18n/zh-cn.json:**
```json
{
  "nav": {
    "home": "首页",
    "blog": "博客",
    "projects": "项目",
    "about": "关于"
  },
  "blog": {
    "readMore": "阅读更多",
    "published": "发布于",
    "updated": "更新于",
    "readingTime": "分钟阅读"
  },
  "common": {
    "backToTop": "回到顶部",
    "loading": "加载中...",
    "notFound": "页面未找到"
  }
}
```

## Translation System

### Create Translation Utility

Create `src/utils/i18n.ts`:

```typescript
import en from '../i18n/en.json'
import zhCn from '../i18n/zh-cn.json'
import ja from '../i18n/ja.json'

const translations = {
  en,
  'zh-cn': zhCn,
  ja
}

export type Locale = keyof typeof translations

export function getTranslation(locale: Locale) {
  return translations[locale] || translations.en
}

export function t(locale: Locale, key: string) {
  const keys = key.split('.')
  let value: any = getTranslation(locale)
  
  for (const k of keys) {
    value = value?.[k]
  }
  
  return value || key
}
```

### Use in Components

```astro
---
// src/components/common/Header.astro
import { t } from '@/utils/i18n'

const locale = Astro.currentLocale as Locale || 'en'
---

<nav>
  <a href={`/${locale}`}>{t(locale, 'nav.home')}</a>
  <a href={`/${locale}/blog`}>{t(locale, 'nav.blog')}</a>
  <a href={`/${locale}/projects`}>{t(locale, 'nav.projects')}</a>
  <a href={`/${locale}/about`}>{t(locale, 'nav.about')}</a>
</nav>
```

## Multi-Language Content

### Blog Posts

Create language-specific content:

```
src/content/blog/
├── en/
│   ├── my-post.md
│   └── another-post.md
├── zh-cn/
│   ├── my-post.md
│   └── another-post.md
└── ja/
    ├── my-post.md
    └── another-post.md
```

### Content Collections Schema

Update `src/content/config.ts`:

```typescript
import { defineCollection, z } from 'astro:content'

const blogCollection = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    description: z.string(),
    pubDate: z.date(),
    lang: z.enum(['en', 'zh-cn', 'ja']).optional(),
    // ... other fields
  })
})

export const collections = {
  blog: blogCollection
}
```

### Create Localized Posts

**src/content/blog/en/hello-world.md:**
```markdown
---
title: "Hello World"
description: "My first blog post"
pubDate: 2024-01-01
lang: en
---

Welcome to my blog!
```

**src/content/blog/zh-cn/hello-world.md:**
```markdown
---
title: "你好世界"
description: "我的第一篇博客"
pubDate: 2024-01-01
lang: zh-cn
---

欢迎来到我的博客！
```

## Routing

### URL Structure

**Option 1: Prefix all languages**
```
/en/blog
/zh-cn/blog
/ja/blog
```

Config:
```javascript
i18n: {
  routing: {
    prefixDefaultLocale: true
  }
}
```

**Option 2: Prefix non-default only (Recommended)**
```
/blog          // English (default)
/zh-cn/blog    // Chinese
/ja/blog       // Japanese
```

Config:
```javascript
i18n: {
  routing: {
    prefixDefaultLocale: false
  }
}
```

### Dynamic Routes

Create localized dynamic routes:

```astro
---
// src/pages/[locale]/blog/[...slug].astro
export function getStaticPaths() {
  const posts = await getCollection('blog')
  
  return posts.map(post => ({
    params: {
      locale: post.data.lang || 'en',
      slug: post.slug
    },
    props: { post }
  }))
}

const { post } = Astro.props
const { locale } = Astro.params
---
```

## Language Switcher

### Create Switcher Component

```astro
---
// src/components/common/LanguageSwitcher.astro
const currentLocale = Astro.currentLocale || 'en'
const currentPath = Astro.url.pathname

const languages = [
  { code: 'en', name: 'English' },
  { code: 'zh-cn', name: '简体中文' },
  { code: 'ja', name: '日本語' }
]

function getLocalizedPath(locale: string) {
  // Convert current path to target locale
  const segments = currentPath.split('/').filter(Boolean)
  
  if (segments[0] === currentLocale) {
    segments[0] = locale
  } else {
    segments.unshift(locale)
  }
  
  return '/' + segments.join('/')
}
---

<div class="language-switcher">
  {languages.map(lang => (
    <a 
      href={getLocalizedPath(lang.code)}
      class:list={['lang-link', { active: currentLocale === lang.code }]}
    >
      {lang.name}
    </a>
  ))}
</div>

<style>
  .language-switcher {
    display: flex;
    gap: 0.5rem;
  }
  
  .lang-link {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    text-decoration: none;
  }
  
  .lang-link.active {
    background: var(--color-primary);
    color: white;
  }
</style>
```

### Add to Header

```astro
---
// src/components/common/Header.astro
import LanguageSwitcher from './LanguageSwitcher.astro'
---

<header>
  <nav>
    <!-- Navigation links -->
  </nav>
  
  <LanguageSwitcher />
</header>
```

## Date Localization

### Format Dates by Locale

```typescript
// src/utils/date.ts
export function formatDate(date: Date, locale: string) {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date)
}
```

Usage:
```astro
---
const { pubDate } = Astro.props
const locale = Astro.currentLocale || 'en'
---

<time datetime={pubDate.toISOString()}>
  {formatDate(pubDate, locale)}
</time>
```

**Output:**
- `en`: January 15, 2024
- `zh-cn`: 2024年1月15日
- `ja`: 2024年1月15日

## Number Localization

### Format Numbers by Locale

```typescript
export function formatNumber(num: number, locale: string) {
  return new Intl.NumberFormat(locale).format(num)
}
```

**Output:**
- `en`: 1,234,567
- `zh-cn`: 1,234,567
- `ja`: 1,234,567

## RTL Support

For right-to-left languages (Arabic, Hebrew):

### Detect Text Direction

```astro
---
const locale = Astro.currentLocale || 'en'
const rtlLocales = ['ar', 'he']
const dir = rtlLocales.includes(locale) ? 'rtl' : 'ltr'
---

<html lang={locale} dir={dir}>
```

### RTL-Specific Styles

```css
/* Use logical properties */
.container {
  margin-inline-start: 1rem;  /* Left in LTR, Right in RTL */
  padding-inline-end: 1rem;   /* Right in LTR, Left in RTL */
}

/* Or use dir attribute */
[dir="rtl"] .container {
  margin-left: 0;
  margin-right: 1rem;
}
```

## SEO for Multi-Language

### Add hreflang Tags

```astro
---
// src/components/common/HeadMeta.astro
const currentUrl = Astro.url.pathname
const languages = ['en', 'zh-cn', 'ja']
---

<head>
  <!-- Default language -->
  <link rel="canonical" href={Astro.url.href} />
  
  <!-- Alternate languages -->
  {languages.map(lang => (
    <link 
      rel="alternate" 
      hreflang={lang}
      href={getLocalizedUrl(currentUrl, lang)}
    />
  ))}
  
  <!-- Default for unmatched locales -->
  <link rel="alternate" hreflang="x-default" href={getLocalizedUrl(currentUrl, 'en')} />
</head>
```

### Language-Specific Meta Tags

```astro
<meta property="og:locale" content={locale.replace('-', '_')} />
{languages
  .filter(lang => lang !== locale)
  .map(lang => (
    <meta property="og:locale:alternate" content={lang.replace('-', '_')} />
  ))
}
```

## Configuration

### User Config

Add language preferences to `src/data/user.config.ts`:

```typescript
export const user = {
  // ... other config
  
  i18n: {
    defaultLocale: 'en',
    locales: [
      { code: 'en', name: 'English' },
      { code: 'zh-cn', name: '简体中文' },
      { code: 'ja', name: '日本語' }
    ]
  }
}
```

## Best Practices

### Content

1. **Consistent translation**: Translate all UI elements
2. **Native speakers**: Use native speakers for translations
3. **Cultural adaptation**: Adapt content for each culture
4. **Avoid machine translation**: For public content
5. **Update all languages**: When changing content

### Technical

1. **Use locale codes**: Follow BCP 47 (e.g., `zh-CN`, `en-US`)
2. **Fallback locale**: Always have English as fallback
3. **JSON structure**: Keep consistent structure across language files
4. **Type safety**: Use TypeScript for translation keys
5. **Lazy loading**: Load only required locale

### Organization

1. **Separate content**: Organize by language
2. **Shared assets**: Images can be shared or localized
3. **URL structure**: Choose consistent URL pattern
4. **Testing**: Test all languages regularly
5. **Documentation**: Document translation process

## Example Locales

### Common Locale Codes

- `en`: English
- `en-US`: English (United States)
- `en-GB`: English (United Kingdom)
- `zh-CN`: Chinese (Simplified, China)
- `zh-TW`: Chinese (Traditional, Taiwan)
- `ja`: Japanese
- `ko`: Korean
- `es`: Spanish
- `fr`: French
- `de`: German
- `pt`: Portuguese
- `pt-BR`: Portuguese (Brazil)
- `ru`: Russian
- `ar`: Arabic
- `hi`: Hindi

## Troubleshooting

### Translations not showing

**Check:**
- Translation file exists
- JSON is valid
- Keys match exactly
- Utility function is imported

### Language switcher not working

**Check:**
- Routes are generated for all locales
- Path conversion logic is correct
- Current locale is detected properly

### Wrong date format

**Check:**
- Locale code is correct (e.g., `en-US` not `en_US`)
- DateTimeFormat options are set
- Browser supports Intl API

### Missing routes

**Check:**
- `getStaticPaths()` generates all locale variants
- Content exists for that locale
- Routing config is correct in `astro.config.mjs`

## Future Enhancements

Potential additions:

- Automatic locale detection from browser
- Translation management UI
- Crowdsourced translations
- Translation progress tracking
- Machine translation suggestions
- Language-specific themes

## Related Documentation

- [Astro i18n Guide](https://docs.astro.build/en/guides/internationalization/)
- [User Configuration](./USER-CONFIG.md)
- [Blog System](./BLOG-SYSTEM.md)
- [Deployment](./DEPLOYMENT.md)

## Resources

- [BCP 47 Language Tags](https://www.w3.org/International/articles/language-tags/)
- [Intl API Documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [Unicode CLDR](https://cldr.unicode.org/)
